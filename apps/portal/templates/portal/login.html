{% extends "portal/base_portal.html" %}
{% load i18n %}

{% block title %}{% trans "Sign In" %}{% endblock %}

{# No quick-exit on login — no sensitive data visible yet #}
{% block quick_exit %}{% endblock %}

{% block content %}
<article class="portal-login-card">
    <header>
        <h1>{% trans "Sign In" %}</h1>
        <p>{% trans "Sign in to see your goals and progress." %}</p>
    </header>

    {% if error %}
    <p role="alert" class="portal-alert portal-alert-error">{{ error }}</p>
    {% endif %}

    {% if show_mfa %}
    {# MFA verification step — shown after password check passes #}
    <form method="post" action="{% url 'portal:login' %}">
        {% csrf_token %}
        <input type="hidden" name="mfa_step" value="1">
        <input type="hidden" name="username" value="{{ username }}">

        <label for="mfa-code">{% trans "Enter the 6-digit code from your authenticator app" %}</label>
        <input type="text" id="mfa-code" name="mfa_code"
               inputmode="numeric" pattern="[0-9]{6}" maxlength="6"
               autocomplete="one-time-code" required autofocus
               aria-describedby="mfa-help"
               placeholder="000000">
        <small id="mfa-help">{% trans "Open your authenticator app and enter the code shown." %}</small>

        <button type="submit">{% trans "Verify" %}</button>
    </form>
    {% else %}
    {# Normal login form #}
    <form method="post" action="{% url 'portal:login' %}">
        {% csrf_token %}

        <label for="email">{% trans "Email" %}</label>
        <input type="email" id="email" name="email" required autofocus
               autocomplete="email"
               aria-describedby="email-help">
        <small id="email-help">{% trans "The email address your worker set up for you." %}</small>

        <label for="password">{% trans "Password" %}</label>
        <input type="password" id="password" name="password" required
               autocomplete="current-password">

        <button type="submit">{% trans "Sign In" %}</button>
    </form>

    <p class="portal-login-links">
        <a href="{% url 'portal:forgot_password' %}">{% trans "Forgot your password?" %}</a>
    </p>
    {% endif %}

    <hr>

    <p class="portal-login-safety">
        <a href="{% url 'portal:safety_help' %}">{% trans "Staying safe online" %}</a>
        <br>
        <small>{% trans "Tips for using this site safely on shared devices." %}</small>
    </p>
</article>
{% endblock %}
