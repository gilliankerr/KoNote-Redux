{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Privacy Policy" %} - {{ site.product_name|default:"KoNote2" }}{% endblock %}

{% block content %}
<div class="privacy-page">
    <h1>{% trans "Privacy Policy" %}</h1>

    <div class="notice">
        <p>{% trans "This page describes how KoNote2 protects your data. Each organisation should customise this policy for their specific practices and hosting configuration." %}</p>
        <p>{% trans "Administrators: See the full privacy policy template in the deployment documentation for a version you can tailor to your organisation." %}</p>
    </div>

    <!-- Quick Navigation -->
    <nav class="privacy-nav" aria-label="{% trans 'Privacy policy navigation' %}">
        <ul>
            <li><a href="#encryption">{% trans "Encryption" %}</a></li>
            <li><a href="#access-control">{% trans "Access Control" %}</a></li>
            <li><a href="#sessions">{% trans "Sessions" %}</a></li>
            <li><a href="#audit">{% trans "Audit Logging" %}</a></li>
            <li><a href="#erasure">{% trans "Data Erasure" %}</a></li>
            <li><a href="#exports">{% trans "Data Exports" %}</a></li>
            <li><a href="#rights">{% trans "Your Rights" %}</a></li>
        </ul>
    </nav>

    <section id="encryption">
        <h2>{% trans "Encryption" %}</h2>

        <h3>{% trans "Data at Rest" %}</h3>
        <p>{% trans "All personally identifiable information (PII) is encrypted before being stored in the database using Fernet symmetric encryption:" %}</p>
        <ul>
            <li>{% trans "Algorithm: AES-128 in CBC mode with HMAC-SHA256 authentication" %}</li>
            <li>{% trans "Encryption keys are stored in environment variables, separate from the database and source code" %}</li>
            <li>{% trans "Key rotation is supported without downtime" %}</li>
        </ul>
        <p><strong>{% trans "Encrypted fields include:" %}</strong> {% trans "names, dates of birth, contact information, email addresses, session notes, and any custom fields marked as sensitive by administrators." %}</p>

        <h3>{% trans "Data in Transit" %}</h3>
        <ul>
            <li>{% trans "All connections are encrypted using TLS (HTTPS)" %}</li>
            <li>{% trans "HTTP Strict Transport Security (HSTS) is enabled" %}</li>
            <li>{% trans "Database connections use SSL/TLS" %}</li>
        </ul>

        <h3>{% trans "Passwords" %}</h3>
        <ul>
            <li>{% trans "Passwords are hashed using Argon2id (winner of the Password Hashing Competition)" %}</li>
            <li>{% trans "Each password has a unique random salt" %}</li>
            <li>{% trans "Passwords are never stored in readable form" %}</li>
            <li>{% trans "Minimum password length: 10 characters" %}</li>
        </ul>
    </section>

    <section id="access-control">
        <h2>{% trans "Access Control" %}</h2>

        <p>{% blocktrans with client=term.client %}Access to {{ client }} information is controlled through role-based permissions:{% endblocktrans %}</p>

        <table>
            <thead>
                <tr>
                    <th scope="col">{% trans "Role" %}</th>
                    <th scope="col">{% trans "Access Level" %}</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>{% trans "Administrator" %}</strong></td>
                    <td>{% blocktrans with client=term.client program=term.program %}System settings and user management. No {{ client }} data access unless also assigned a {{ program }} role.{% endblocktrans %}</td>
                </tr>
                <tr>
                    <td><strong>{% trans "Program Manager" %}</strong></td>
                    <td>{% blocktrans with client_plural=term.client_plural program_plural=term.program_plural plans=term.plan_plural %}Full access to {{ client_plural }} in assigned {{ program_plural }}. Can edit {{ plans }} and export data.{% endblocktrans %}</td>
                </tr>
                <tr>
                    <td><strong>{% trans "Staff" %}</strong></td>
                    <td>{% blocktrans with client_plural=term.client_plural program_plural=term.program_plural %}Access to {{ client_plural }} in assigned {{ program_plural }}. Can write notes and record events.{% endblocktrans %}</td>
                </tr>
                <tr>
                    <td><strong>{% trans "Front Desk" %}</strong></td>
                    <td>{% blocktrans with client=term.client %}Limited {{ client }} information only. Cannot view full records or export data.{% endblocktrans %}</td>
                </tr>
            </tbody>
        </table>

        <ul>
            <li>{% blocktrans with client_plural=term.client_plural program_plural=term.program_plural %}Staff can only see {{ client_plural }} in {{ program_plural }} they are assigned to{% endblocktrans %}</li>
            <li>{% trans "Administrative functions are restricted to administrators" %}</li>
            <li>{% trans "All permission checks are enforced server-side" %}</li>
        </ul>
    </section>

    <section id="sessions">
        <h2>{% trans "Sessions and Cookies" %}</h2>

        <ul>
            <li>{% trans "Sessions automatically expire after a period of inactivity (default: 30 minutes)" %}</li>
            <li>{% trans "Session timeout resets with each action you take" %}</li>
            <li>{% trans "Sessions are stored server-side — only a session identifier is kept in your browser" %}</li>
            <li>{% trans "Cookies are HTTP-only (not accessible to JavaScript) and secure (HTTPS only)" %}</li>
        </ul>

        <p>{% trans "KoNote2 uses only essential cookies required for the application to function. No advertising, tracking, or analytics cookies are used." %}</p>
    </section>

    <section id="audit">
        <h2>{% trans "Audit Logging" %}</h2>

        <p>{% blocktrans with client=term.client %}All access to and changes of {{ client }} data are recorded in a separate audit database:{% endblocktrans %}</p>
        <ul>
            <li>{% trans "Login attempts (successful and failed) with timestamps and IP addresses" %}</li>
            <li>{% blocktrans with client=term.client %}Every time a {{ client }} record is viewed{% endblocktrans %}</li>
            <li>{% trans "All data changes with before and after values" %}</li>
            <li>{% trans "Data exports — who exported what and when" %}</li>
            <li>{% trans "Permission changes and administrative actions" %}</li>
        </ul>
        <p>{% trans "Audit logs are stored in a separate database and are append-only — they cannot be modified or deleted through the application." %}</p>
    </section>

    <section id="erasure">
        <h2>{% trans "Data Erasure" %}</h2>

        <p>{% trans "KoNote2 supports formal data erasure requests in compliance with PIPEDA:" %}</p>
        <ul>
            <li>{% blocktrans with client=term.client %}Any staff member can initiate an erasure request for a {{ client }}{% endblocktrans %}</li>
            <li>{% blocktrans with client=term.client program_plural=term.program_plural %}All program managers for that {{ client }}'s {{ program_plural }} must approve the request{% endblocktrans %}</li>
            <li>{% blocktrans with client=term.client %}Once approved, all {{ client }} data is permanently and irreversibly deleted{% endblocktrans %}</li>
            <li>{% trans "The audit trail records that an erasure occurred, but no personal information is retained" %}</li>
        </ul>
    </section>

    <section id="exports">
        <h2>{% trans "Data Exports" %}</h2>

        <ul>
            <li>{% blocktrans with metric=term.metric %}Program managers and administrators can export {{ metric }} data in CSV format{% endblocktrans %}</li>
            <li>{% blocktrans with client=term.client %}Individual {{ client }} data can be exported for privacy access requests{% endblocktrans %}</li>
            <li>{% trans "Export download links expire after a limited time" %}</li>
            <li>{% trans "All exports are recorded in the audit log" %}</li>
            <li>{% trans "Exported files include protections against formula injection" %}</li>
        </ul>
    </section>

    <section id="rights">
        <h2>{% trans "Your Rights" %}</h2>

        <p>{% trans "Under PIPEDA and applicable privacy legislation, you have the right to:" %}</p>
        <ul>
            <li>{% trans "Request access to your personal information" %}</li>
            <li>{% trans "Request correction of inaccurate information" %}</li>
            <li>{% trans "Request erasure of your personal information" %}</li>
            <li>{% trans "Withdraw consent for specific uses" %}</li>
            <li>{% trans "File a complaint with the Privacy Commissioner of Canada" %}</li>
        </ul>
        <p>{% trans "Organisations must respond to access requests within 30 days as required by PIPEDA." %}</p>
    </section>

    <section>
        <h2>{% trans "Contact" %}</h2>

        {% if site.support_email %}
        <p>{% trans "For privacy questions, contact:" %} <a href="mailto:{{ site.support_email }}">{{ site.support_email }}</a></p>
        {% else %}
        <p>{% trans "Please contact your system administrator for privacy questions." %}</p>
        {% endif %}

        <p>{% trans "For complaints not resolved to your satisfaction:" %}</p>
        <p><strong>{% trans "Office of the Privacy Commissioner of Canada" %}</strong><br>
        {% trans "Website:" %} <a href="https://www.priv.gc.ca" target="_blank" rel="noopener">www.priv.gc.ca</a><br>
        {% trans "Phone:" %} 1-800-282-1376</p>
    </section>

</div>

<style>
.privacy-page {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem 1rem;
}

.privacy-page .notice {
    background: var(--pico-form-element-background-color, #fff3cd);
    border: 1px solid var(--pico-form-element-border-color, #ffc107);
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 2rem;
}

.privacy-nav {
    background: var(--pico-card-background-color, #f5f5f5);
    padding: 1rem 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
}

.privacy-nav ul {
    columns: 2;
    margin-bottom: 0;
    list-style: none;
    padding: 0;
}

@media (max-width: 600px) {
    .privacy-nav ul {
        columns: 1;
    }
}

.privacy-page section {
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--pico-muted-border-color, #e0e0e0);
}

.privacy-page section:last-child {
    border-bottom: none;
}

.privacy-page h2 {
    color: var(--pico-primary, #1976d2);
    border-bottom: 2px solid var(--pico-primary, #1976d2);
    padding-bottom: 0.5rem;
    margin-top: 2rem;
}

.privacy-page h3 {
    margin-top: 1.5rem;
    color: var(--pico-secondary, #607d8b);
}

.privacy-page ul {
    margin-left: 1.5rem;
}

.privacy-page li {
    margin-bottom: 0.5rem;
}

.privacy-page table {
    margin: 1rem 0;
}

@media print {
    .privacy-page section {
        break-inside: avoid;
    }
}
</style>
{% endblock %}
