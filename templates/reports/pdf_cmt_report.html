{% extends "reports/pdf_base.html" %}

{% block title %}Funder Report â€” {{ cmt_data.programme_name }}{% endblock %}

{% block styles %}
{{ block.super }}
/* Additional CMT-specific styles */
.cmt-header {
    background-color: #0d7377;
    color: #ffffff;
    padding: 0.3cm 0.5cm;
    margin-top: 1cm;
    font-size: 12pt;
    font-weight: 600;
}
.stat-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 0.4cm;
    margin: 0.5cm 0;
}
.stat-box {
    border: 1px solid #d1d5db;
    border-radius: 4px;
    padding: 0.3cm;
    text-align: center;
}
.stat-box .value {
    font-size: 18pt;
    font-weight: 700;
    color: #0d7377;
}
.stat-box .label {
    font-size: 9pt;
    color: #718096;
    margin-top: 0.1cm;
}
.outcome-card {
    border: 2px solid #0d7377;
    border-radius: 4px;
    padding: 0.4cm;
    margin: 0.3cm 0;
}
.outcome-card h4 {
    margin: 0 0 0.2cm 0;
    color: #0d7377;
    font-size: 11pt;
}
.outcome-card .rate {
    font-size: 24pt;
    font-weight: 700;
    color: #0d7377;
}
.outcome-card .details {
    font-size: 9pt;
    color: #4a5568;
    margin-top: 0.2cm;
}
.demo-row {
    display: grid;
    grid-template-columns: 1fr 80px 80px;
    padding: 4px 10px;
    border-bottom: 1px solid #e5e7eb;
}
.demo-row.header {
    background-color: #f7f8fa;
    font-weight: 600;
}
.demo-bar {
    background-color: #e5e7eb;
    height: 8px;
    border-radius: 4px;
    margin-top: 4px;
}
.demo-bar-fill {
    background-color: #0d7377;
    height: 100%;
    border-radius: 4px;
}
.footer-note {
    font-size: 9pt;
    color: #718096;
    font-style: italic;
    margin-top: 1cm;
    padding-top: 0.3cm;
    border-top: 1px solid #e5e7eb;
}
{% endblock %}

{% block content %}
<!-- Cover Page -->
<div class="pdf-cover">
    <h1>Funder Report</h1>
    <div class="subtitle">{{ cmt_data.programme_name }}</div>
    <div class="meta">
        {{ cmt_data.organisation_name }}<br>
        {{ cmt_data.reporting_period }}<br><br>
        Generated {{ cmt_data.generated_at|date:"Y-m-d" }} by {{ generated_by }}
    </div>
    <div style="margin-top: 1cm; padding: 0.5cm; background-color: #fef3c7; border-radius: 4px; font-size: 10pt;">
        <strong>Draft Template:</strong> Verify this format matches your funder's requirements before submission.
    </div>
</div>

<!-- Organisation Information -->
<h2>Organisation Information</h2>
<dl>
    <dt>Organisation Name</dt>
    <dd>{{ cmt_data.organisation_name }}</dd>
    <dt>Programme/Service Name</dt>
    <dd>{{ cmt_data.programme_name }}</dd>
    {% if cmt_data.programme_description %}
    <dt>Programme Description</dt>
    <dd>{{ cmt_data.programme_description }}</dd>
    {% endif %}
    <dt>Reporting Period</dt>
    <dd>{{ cmt_data.reporting_period }}</dd>
</dl>

<!-- Service Statistics -->
<div class="cmt-header">Service Statistics</div>
<div class="stat-grid">
    <div class="stat-box">
        <div class="value">{{ cmt_data.total_individuals_served|default:"0" }}</div>
        <div class="label">Total Individuals Served</div>
    </div>
    <div class="stat-box">
        <div class="value">{{ cmt_data.new_clients_this_period|default:"0" }}</div>
        <div class="label">New Clients This Period</div>
    </div>
    <div class="stat-box">
        <div class="value">{{ cmt_data.total_contacts|default:"0" }}</div>
        <div class="label">Total Service Contacts</div>
    </div>
</div>

<!-- Age Demographics -->
<div class="cmt-header">Age Demographics</div>
<div style="margin: 0.5cm 0;">
    <div class="demo-row header">
        <div>Age Group</div>
        <div style="text-align: right;">Count</div>
        <div style="text-align: right;">Percentage</div>
    </div>
    {% for age_group, count in cmt_data.age_demographics.items %}
    <div class="demo-row">
        <div>
            {{ age_group }}
            {% if cmt_data.age_demographics_total > 0 %}
            <div class="demo-bar">
                <div class="demo-bar-fill" style="width: {% widthratio count cmt_data.age_demographics_total 100 %}%;"></div>
            </div>
            {% endif %}
        </div>
        <div style="text-align: right;">{{ count }}</div>
        <div style="text-align: right;">
            {% if cmt_data.age_demographics_total > 0 %}
            {% widthratio count cmt_data.age_demographics_total 100 %}%
            {% else %}
            N/A
            {% endif %}
        </div>
    </div>
    {% endfor %}
    <div class="demo-row header">
        <div>Total</div>
        <div style="text-align: right;">{{ cmt_data.age_demographics_total }}</div>
        <div style="text-align: right;">100%</div>
    </div>
</div>

<!-- Outcome Indicators -->
<div class="page-break"></div>
<h2>Outcome Indicators</h2>

{% if cmt_data.primary_outcome %}
<h3>Primary Outcome</h3>
<div class="outcome-card">
    <h4>{{ cmt_data.primary_outcome.name }}</h4>
    <div class="rate">{{ cmt_data.primary_outcome.achievement_rate }}%</div>
    <div class="details">
        <strong>Target:</strong> {{ cmt_data.primary_outcome.target_value }}<br>
        <strong>Clients Measured:</strong> {{ cmt_data.primary_outcome.clients_measured }}<br>
        <strong>Clients Achieving Target:</strong> {{ cmt_data.primary_outcome.clients_achieved }} of {{ cmt_data.primary_outcome.clients_measured }}
    </div>
</div>
{% endif %}

{% if cmt_data.secondary_outcomes %}
<h3>Secondary Outcomes</h3>
<table>
    <thead>
        <tr>
            <th>Indicator Name</th>
            <th>Target</th>
            <th>Measured</th>
            <th>Achieved</th>
            <th>Rate</th>
        </tr>
    </thead>
    <tbody>
        {% for outcome in cmt_data.secondary_outcomes %}
        <tr>
            <td>{{ outcome.name }}</td>
            <td>{{ outcome.target_value }}</td>
            <td>{{ outcome.clients_measured }}</td>
            <td>{{ outcome.clients_achieved }}</td>
            <td>{{ outcome.achievement_rate }}%</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}

{% if not cmt_data.primary_outcome and not cmt_data.secondary_outcomes %}
<p><em>No outcome indicators with targets defined for this programme.</em></p>
{% endif %}

<!-- Overall Summary -->
{% if cmt_data.achievement_summary.total_clients > 0 %}
<div class="cmt-header">Overall Summary</div>
<div class="summary-grid">
    <div class="summary-card">
        <div class="number">{{ cmt_data.achievement_summary.overall_rate }}%</div>
        <div class="label">Overall Achievement Rate</div>
    </div>
    <div class="summary-card">
        <div class="number">{{ cmt_data.achievement_summary.clients_met_any_target }} / {{ cmt_data.achievement_summary.total_clients }}</div>
        <div class="label">Clients Met at Least One Target</div>
    </div>
</div>
{% endif %}

<div class="footer-note">
    <strong>Draft Template:</strong> This report was generated using KoNote's Funder Report Template.
    Verify this format matches your funder's specific requirements before submission.
    Data reflects client outcomes recorded during the {{ cmt_data.reporting_period }} reporting period.
</div>
{% endblock %}
