{% load i18n %}
{# Partial: Read-only display of custom fields with edit toggle #}
{# Empty fields are filtered out in the view â€” only fields with values shown #}
<div class="custom-fields-header">
    <h2 id="custom-fields-heading">{% trans "Additional Details" %}</h2>
    {% if has_editable_fields %}
    <button type="button"
            class="outline"
            hx-get="{% url 'clients:client_custom_fields_edit' client_id=client.pk %}"
            hx-target="#custom-fields-section"
            hx-swap="innerHTML"
            aria-describedby="custom-fields-heading"
            aria-label="{% trans 'Edit additional details' %}">
        &#9998; {% trans "Edit" %}
    </button>
    {% endif %}
</div>

{% for group in custom_data %}
<section aria-labelledby="group-{{ group.group.pk }}">
    <h3 id="group-{{ group.group.pk }}">{{ group.group.title }}</h3>
    <dl class="info-grid-compact">
        {% for item in group.fields %}
        <div class="info-field{% if not item.is_editable %} view-only{% endif %}">
            <dt>
                {{ item.field_def.name }}
                {% if not item.is_editable %}<small class="secondary">({% trans "view only" %})</small>{% endif %}
                {% if item.field_def.is_sensitive %}<small class="secondary">({% trans "encrypted" %})</small>{% endif %}
            </dt>
            <dd>{{ item.value }}</dd>
        </div>
        {% endfor %}
    </dl>
</section>
{% endfor %}

{% if not custom_data %}
<p class="secondary" style="margin-top: var(--kn-space-base);">{% trans "No additional details recorded. Click Edit to add information." %}</p>
{% endif %}
