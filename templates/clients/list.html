{% extends "base.html" %}
{% load i18n %}

{% block title %}{{ term.client_plural|default:"Participants" }} â€” {{ site.product_name|default:"KoNote2" }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1>{{ term.client_plural|default:"Participants" }}</h1>
    <p>{% blocktrans with client=term.client|default:"participant" %}All {{ client }} files you have access to.{% endblocktrans %}</p>
</div>

<p><a href="{% url 'clients:client_create' %}" role="button">{% blocktrans with client=term.client|default:"Participant" %}New {{ client }}{% endblocktrans %}</a></p>

<!-- Search and filter bar -->
<details class="filter-bar" open>
    <summary>{% trans "Filters" %}</summary>
    <form id="client-filters" role="search">
        <div class="filter-row">
            <div class="filter-field filter-field--search">
                <label for="client-search">{% blocktrans with clients=term.client_plural|default:"Participants" %}Search {{ clients }}{% endblocktrans %}</label>
                <input type="search"
                       id="client-search"
                       name="q"
                       placeholder="{% trans 'Search by name, ID, or note content...' %}"
                       value="{{ search_query }}"
                       aria-label="{% blocktrans with clients=term.client_plural|default:'participants' %}Search {{ clients }}{% endblocktrans %}"
                       hx-get="{% url 'clients:client_list' %}"
                       hx-trigger="input changed delay:300ms"
                       hx-target="#client-list-container"
                       hx-include="#client-filters"
                       hx-indicator="#loading-bar">
            </div>
            <div class="filter-field">
                <label for="filter-status">{% trans "Status" %}</label>
                <select id="filter-status"
                        name="status"
                        hx-get="{% url 'clients:client_list' %}"
                        hx-target="#client-list-container"
                        hx-include="#client-filters"
                        hx-indicator="#loading-bar"
                        hx-push-url="true">
                    <option value="">{% trans "All statuses" %}</option>
                    <option value="active"{% if status_filter == "active" %} selected{% endif %}>{% trans "Active" %}</option>
                    <option value="inactive"{% if status_filter == "inactive" %} selected{% endif %}>{% trans "Inactive" %}</option>
                    <option value="discharged"{% if status_filter == "discharged" %} selected{% endif %}>{% trans "Discharged" %}</option>
                </select>
            </div>
            {% if features.programs and accessible_programs %}
            <div class="filter-field">
                <label for="filter-program">{{ term.program|default:"Program" }}</label>
                <select id="filter-program"
                        name="program"
                        hx-get="{% url 'clients:client_list' %}"
                        hx-target="#client-list-container"
                        hx-include="#client-filters"
                        hx-indicator="#loading-bar"
                        hx-push-url="true">
                    <option value="">{% blocktrans with programs=term.program_plural|default:"programs" %}All {{ programs }}{% endblocktrans %}</option>
                    {% for prog in accessible_programs %}
                    <option value="{{ prog.pk }}"{% if program_filter == prog.pk|stringformat:"d" %} selected{% endif %}>{{ prog.name }}</option>
                    {% endfor %}
                </select>
            </div>
            {% endif %}
            <div class="filter-actions">
                <a href="{% url 'clients:client_list' %}" class="secondary" role="button">{% trans "Clear filters" %}</a>
            </div>
        </div>
    </form>
</details>

<!-- Client list container (updated via HTMX) -->
<div id="client-list-container" aria-live="polite">
    {% include "clients/_client_list_table.html" %}
</div>
{% endblock %}
