{% extends "base.html" %}
{% load i18n %}

{% block title %}{{ program.name }} — {{ site.product_name|default:"KoNote2" }}{% endblock %}

{% block content %}
<hgroup>
    <h1>
        <span class="program-dot" style="background-color: {{ program.colour_hex }}" aria-hidden="true"></span>
        {{ program.name }}
    </h1>
    <p>{{ program.description }}</p>
</hgroup>

<p>
    <small>
        {% if program.service_model == "individual" %}
            {% trans "One-on-one — individual notes and plans" %}
        {% elif program.service_model == "group" %}
            {% trans "Group sessions — attendance and session notes" %}
        {% else %}
            {% trans "Both — individual notes and group sessions" %}
        {% endif %}
        {% if program.is_confidential %}
            &middot; <strong>{% trans "Confidential" %}</strong>
        {% endif %}
    </small>
</p>

<div role="group">
    {% if is_admin %}
    <a href="{% url 'programs:program_edit' program_id=program.pk %}" role="button" class="outline">{% blocktrans with program=term.program|default:"Program" %}Edit {{ program }}{% endblocktrans %}</a>
    {% endif %}
    <a href="{% url 'programs:program_list' %}" class="back-link">&larr; {% trans "Back to List" %}</a>
</div>

<hr>

<h2>{% trans "Assigned Staff" %}</h2>

{% if is_admin %}
<form hx-post="{% url 'programs:program_add_role' program_id=program.pk %}"
      hx-target="#role-list"
      hx-swap="innerHTML">
    {% csrf_token %}
    <fieldset role="group">
        <select name="user" aria-label="{% trans 'Select user' %}" required>
            <option value="">{% trans "Choose a user..." %}</option>
            {% for option in role_form.user.field.queryset %}
            <option value="{{ option.pk }}">{{ option.display_name }}</option>
            {% endfor %}
        </select>
        <select name="role" aria-label="{% trans 'Select role' %}" required>
            {% for value, label in role_form.role.field.choices %}
            <option value="{{ value }}">{{ label }}</option>
            {% endfor %}
        </select>
        <button type="submit">{% trans "Add" %}</button>
    </fieldset>
</form>
{% endif %}

<div id="role-list" aria-live="polite">
    {% include "programs/_role_list.html" %}
</div>
{% endblock %}
