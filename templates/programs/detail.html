{% extends "base.html" %}
{% load i18n %}

{% block title %}{{ program.translated_name }} — {{ site.product_name|default:"KoNote2" }}{% endblock %}

{% block content %}
<hgroup>
    <h1>
        <span class="program-dot" style="background-color: {{ program.colour_hex }}" aria-hidden="true"></span>
        {{ program.translated_name }}
    </h1>
    <p>{{ program.description }}</p>
</hgroup>

<p>
    <small>
        {% if program.service_model == "individual" %}
            {% trans "One-on-one — individual notes and plans" %}
        {% elif program.service_model == "group" %}
            {% trans "Group sessions — attendance and session notes" %}
        {% else %}
            {% trans "Both — individual notes and group sessions" %}
        {% endif %}
        {% if program.is_confidential %}
            &middot; <strong>{% trans "Confidential" %}</strong>
        {% endif %}
    </small>
</p>

<div role="group">
    {% if is_admin %}
    <a href="{% url 'programs:program_edit' program_id=program.pk %}" role="button" class="outline">{% blocktrans with program=term.program|default:"Program" %}Edit {{ program }}{% endblocktrans %}</a>
    {% endif %}
    <a href="{% url 'programs:program_list' %}" class="back-link">&larr; {% trans "Back to List" %}</a>
</div>

<hr>

<h2>{% trans "Assigned Staff" %}</h2>

{% if is_admin %}
<form hx-post="{% url 'programs:program_add_role' program_id=program.pk %}"
      hx-target="#role-list"
      hx-swap="innerHTML">
    {% csrf_token %}
    <fieldset role="group">
        <select name="user" aria-label="{% trans 'Select user' %}" required>
            <option value="">{% trans "Choose a user..." %}</option>
            {% for option in role_form.user.field.queryset %}
            <option value="{{ option.pk }}">{{ option.display_name }}</option>
            {% endfor %}
        </select>
        <select name="role" aria-label="{% trans 'Select role' %}" required>
            {% for value, label in role_form.role.field.choices %}
            <option value="{{ value }}">{{ label }}</option>
            {% endfor %}
        </select>
        <button type="submit">{% trans "Add" %}</button>
    </fieldset>
</form>
{% endif %}

<div id="role-list" aria-live="polite">
    {% include "programs/_role_list.html" %}
</div>

{% if groups != None %}
<hr>
<section aria-labelledby="groups-heading">
    <h2 id="groups-heading">{% trans "Groups" %}</h2>

    {% if groups %}
    <figure>
    <table role="grid" aria-label="{% trans 'Groups in this program' %}">
        <thead>
            <tr>
                <th scope="col">{% trans "Name" %}</th>
                <th scope="col">{% trans "Members" %}</th>
                <th scope="col">{% trans "Actions" %}</th>
            </tr>
        </thead>
        <tbody>
            {% for group in groups %}
            <tr>
                <td><a href="{% url 'groups:group_detail' group_id=group.pk %}">{{ group.name }}</a></td>
                <td data-label="{% trans 'Members' %}">{{ group.member_count }}</td>
                <td data-label="{% trans 'Actions' %}">
                    <a href="{% url 'groups:session_log' group_id=group.pk %}" role="button" class="outline small">{% trans "Log Session" %}</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    </figure>
    {% else %}
    <p><em>{% trans "No groups created yet." %}</em></p>
    {% endif %}

    <a href="{% url 'groups:group_create' %}" role="button" class="outline">{% trans "Create Group" %}</a>
</section>
{% endif %}
{% endblock %}
