{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "New Users" %} — {{ site.product_name|default:"KoNote" }}{% endblock %}

{% block content %}
<hgroup>
    <h1>{% trans "New Users" %}</h1>
    <p>{% trans "Manage invite links for new users" %}</p>
</hgroup>

<p><a href="{% url 'admin_users:invite_create' %}" role="button">+ {% trans "New Invite" %}</a></p>

<figure>
<table role="grid" aria-label="{% trans 'Invite list' %}">
    <thead>
        <tr>
            <th scope="col">{% trans "Role" %}</th>
            <th scope="col">{{ term.program_plural|default:"Programs" }}</th>
            <th scope="col">{% trans "Created" %}</th>
            <th scope="col">{% trans "Expires" %}</th>
            <th scope="col">{% trans "Status" %}</th>
            <th scope="col">{% trans "Link" %}</th>
        </tr>
    </thead>
    <tbody>
        {% for invite in invites %}
        <tr>
            <td>{{ invite.get_role_display }}</td>
            <td>
                {% for p in invite.programs.all %}
                    <span class="badge" style="background-color: {{ p.colour_hex }};">{{ p.name }}</span>
                {% empty %}
                    —
                {% endfor %}
            </td>
            <td>{{ invite.created_at|date:"Y-m-d" }} {% trans "by" %} {{ invite.created_by.display_name }}</td>
            <td>{{ invite.expires_at|date:"Y-m-d" }}</td>
            <td>
                {% if invite.is_used %}
                    <span class="badge badge-success">{% blocktrans with name=invite.used_by.display_name %}Used by {{ name }}{% endblocktrans %}</span>
                {% elif invite.is_expired %}
                    <span class="badge badge-warning">{% trans "Expired" %}</span>
                {% else %}
                    <span class="badge badge-neutral">{% trans "Pending" %}</span>
                {% endif %}
            </td>
            <td>
                {% if invite.is_valid %}
                <input type="text" readonly value="{{ request.scheme }}://{{ request.get_host }}/auth/join/{{ invite.code }}/"
                       style="font-size: 0.8em; padding: 0.25em;" aria-label="{% trans 'Invite link' %}"
                       onclick="this.select()">
                {% else %}
                    —
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr><td colspan="6">{% trans "No invites yet. Create one to get started." %}</td></tr>
        {% endfor %}
    </tbody>
</table>
</figure>
{% endblock %}
