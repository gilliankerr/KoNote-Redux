{% extends "base.html" %}

{% block title %}{{ term.progress_note|default:"Notes" }} — {{ client.first_name }} {{ client.last_name }}{% endblock %}

{% block content %}
<hgroup>
    <h1>{{ client.first_name }} {{ client.last_name }}</h1>
    <p>
        {% if client.status == "active" %}
            <span class="badge badge-success">Active</span>
        {% elif client.status == "inactive" %}
            <span class="badge badge-warning">Inactive</span>
        {% else %}
            <span class="badge badge-neutral">Discharged</span>
        {% endif %}
        {% if client.record_id %}— Record ID: {{ client.record_id }}{% endif %}
    </p>
</hgroup>

<div role="group">
    <a href="{% url 'notes:quick_note_create' client_id=client.pk %}" role="button">{{ term.quick_note|default:"Quick Note" }}</a>
    <a href="#" role="button" class="outline" aria-disabled="true">Full {{ term.progress_note|default:"Note" }} (coming soon)</a>
</div>

<!-- Tabs -->
<nav>
    <ul>
        <li><a href="{% url 'clients:client_detail' client_id=client.pk %}">Info</a></li>
        <li><a href="{% url 'plans:plan_view' client_id=client.pk %}">{{ term.plan|default:"Plan" }}</a></li>
        <li><strong>{{ term.progress_note|default:"Notes" }}</strong></li>
        <li><a href="#" class="secondary" aria-disabled="true">Analysis (Phase 5)</a></li>
    </ul>
</nav>

<hr>

{% if notes %}
<div id="notes-timeline">
    {% for note in notes %}
    <article id="note-{{ note.pk }}">
        <header>
            <div>
                {% if note.note_type == "quick" %}
                    <span class="badge badge-info">{{ term.quick_note|default:"Quick" }}</span>
                {% else %}
                    <span class="badge badge-success">Full</span>
                {% endif %}
                {% if note.status == "cancelled" %}
                    <span class="badge badge-danger">Cancelled</span>
                {% endif %}
                <strong>{{ note.effective_date|date:"Y-m-d" }}</strong>
                — {{ note.author.display_name|default:note.author }}
                {% if note.author_program %}
                    <small>({{ note.author_program.name }})</small>
                {% endif %}
            </div>
        </header>
        {% if note.status == "cancelled" %}
            <p><del>{{ note.notes_text|truncatechars:200 }}</del></p>
            {% if note.status_reason %}<p><small>Reason: {{ note.status_reason }}</small></p>{% endif %}
        {% else %}
            <p>{{ note.notes_text|truncatechars:200 }}</p>
        {% endif %}
        <footer>
            <!-- Expand/collapse will be added in Step 4 -->
        </footer>
    </article>
    {% endfor %}
</div>
{% else %}
<p class="empty-state">No {{ term.progress_note|default:"notes" }} recorded yet.</p>
{% endif %}
{% endblock %}
