{% extends "base.html" %}
{% load i18n %}

{% block title %}{% blocktrans with note=term.progress_note|default:"Note" %}Quick {{ note }}{% endblocktrans %} — {{ client.first_name }} {{ client.last_name }}{% endblock %}

{% block content %}
{% include "_breadcrumbs.html" %}
<hgroup>
    <h1>{% blocktrans with note=term.progress_note|default:"Note" %}Quick {{ note }}{% endblocktrans %}</h1>
    <p>{{ client.first_name }} {{ client.last_name }}</p>
</hgroup>

<form method="post" data-autosave data-client-id="{{ client.pk }}" data-form-type="quick">
    {% csrf_token %}
    <label for="{{ form.notes_text.id_for_label }}">{{ term.progress_note|default:"Note" }}</label>
    {{ form.notes_text }}
    {% if form.notes_text.errors %}
    <small class="error" role="alert">{{ form.notes_text.errors.0 }}</small>
    {% endif %}

    <!-- Follow-up date (optional) -->
    <label for="{{ form.follow_up_date.id_for_label }}">{% trans "Follow up by" %}</label>
    {{ form.follow_up_date }}
    <small>{% trans "(optional — adds to your home page reminders)" %}</small>
    {% if form.follow_up_date.errors %}
    <small class="error" role="alert">{{ form.follow_up_date.errors.0 }}</small>
    {% endif %}

    <!-- Sticky footer with consent and save -->
    <div class="sticky-form-footer{% if form.consent_confirmed.errors %} has-error{% endif %}" role="region" aria-label="{% trans 'Consent and save' %}">
        <div class="sticky-form-footer-inner">
            <div class="consent-section">
                <label for="{{ form.consent_confirmed.id_for_label }}">
                    {{ form.consent_confirmed }}
                    {% trans "I confirm verbal consent was obtained" %}
                </label>
                {% if form.consent_confirmed.errors %}
                <small class="error" role="alert">{{ form.consent_confirmed.errors.0 }}</small>
                {% endif %}
            </div>
            <span class="autosave-indicator" id="autosave-status" hidden aria-live="polite" role="status">
                <span class="status-text">{% trans "Saved" %}</span>
            </span>
            <div class="button-group">
                <a href="{% url 'notes:note_list' client_id=client.pk %}" role="button" class="outline secondary">{% trans "Cancel" %}</a>
                <button type="submit">{% blocktrans with note=term.quick_note|default:"Quick Note" %}Save {{ note }}{% endblocktrans %}</button>
            </div>
        </div>
    </div>
</form>
{% endblock %}
