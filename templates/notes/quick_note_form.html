{% extends "base.html" %}
{% load i18n %}

{% block title %}{% blocktrans with note=term.progress_note|default:"Note" %}Quick {{ note }}{% endblocktrans %} — {{ client.display_name }} {{ client.last_name }}{% endblock %}

{% block content %}
{% include "_breadcrumbs.html" %}
<hgroup>
    <h1>{% blocktrans with note=term.progress_note|default:"Note" %}Quick {{ note }}{% endblocktrans %}</h1>
    <p>{{ client.display_name }} {{ client.last_name }}</p>
</hgroup>

<form method="post" data-autosave data-client-id="{{ client.pk }}" data-form-type="quick">
    {% csrf_token %}

    <!-- Non-field errors (e.g. cross-field validation) -->
    {% if form.non_field_errors %}
    <div role="alert">
        {{ form.non_field_errors }}
    </div>
    {% endif %}

    <!-- Interaction type — radio pills -->
    <fieldset class="interaction-pills"{% if form.interaction_type.errors %} aria-describedby="interaction-type-errors"{% endif %}>
        <legend>{% trans "What kind of interaction?" %}</legend>
        {% for radio in form.interaction_type %}
        {{ radio }}
        {% endfor %}
    </fieldset>
    {% if form.interaction_type.errors %}
    <div id="interaction-type-errors" role="alert">
        {{ form.interaction_type.errors }}
    </div>
    {% endif %}

    <label for="{{ form.notes_text.id_for_label }}">{{ term.progress_note|default:"Note" }}</label>
    {{ form.notes_text }}
    {% if form.notes_text.errors %}
    <div id="notes-text-errors" role="alert">
        {{ form.notes_text.errors }}
    </div>
    {% endif %}

    <!-- Follow-up date (optional) -->
    <label for="{{ form.follow_up_date.id_for_label }}">{% trans "Follow up by" %}</label>
    {{ form.follow_up_date }}
    <small>{% trans "(optional — adds to your home page reminders)" %}</small>
    {% if form.follow_up_date.errors %}
    <div id="follow-up-errors" role="alert">
        {{ form.follow_up_date.errors }}
    </div>
    {% endif %}

    <!-- Sticky footer with consent and save -->
    <div class="sticky-form-footer{% if form.consent_confirmed.errors %} has-error{% endif %}" role="region" aria-label="{% trans 'Consent and save' %}">
        <div class="sticky-form-footer-inner">
            <div class="consent-section">
                <label for="{{ form.consent_confirmed.id_for_label }}">
                    {{ form.consent_confirmed }}
                    {% trans "I confirm verbal consent was obtained" %}
                </label>
                {% if form.consent_confirmed.errors %}
                <div id="consent-errors" role="alert">
                    {{ form.consent_confirmed.errors }}
                </div>
                {% endif %}
            </div>
            <span class="autosave-indicator" id="autosave-status" hidden aria-live="polite" role="status">
                <span class="status-text">{% trans "Saved" %}</span>
            </span>
            <div class="button-group">
                <a href="{% url 'notes:note_list' client_id=client.pk %}" role="button" class="outline secondary">{% trans "Cancel" %}</a>
                <button type="submit">{% blocktrans with note=term.quick_note|default:"Quick Note" %}Save {{ note }}{% endblocktrans %}</button>
            </div>
        </div>
    </div>
</form>
{% endblock %}
