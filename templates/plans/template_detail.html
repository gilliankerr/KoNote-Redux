{% extends "base.html" %}
{% load i18n %}

{% block title %}{{ template.name }} â€” {{ site.product_name|default:"KoNote" }}{% endblock %}

{% block content %}
<nav aria-label="{% trans 'Breadcrumb' %}">
    <ul>
        <li><a href="{% url 'plan_templates:template_list' %}">{% trans "Templates" %}</a></li>
        <li>{{ template.name }}</li>
    </ul>
</nav>

<hgroup>
    <h1>{{ template.name }}</h1>
    {% if template.description %}<p>{{ template.description }}</p>{% endif %}
</hgroup>

<p>
    {% trans "Status:" %}
    {% if template.status == "active" %}
        <span class="badge badge-success">{% trans "Active" %}</span>
    {% else %}
        <span class="badge badge-neutral">{% trans "Archived" %}</span>
    {% endif %}
    &nbsp;
    <a href="{% url 'plan_templates:template_edit' template_id=template.pk %}">{% trans "Edit Template" %}</a>
</p>

<hr>

<h2>{{ term.section_plural|default:"Sections" }}</h2>

<p>
    <a href="{% url 'plan_templates:template_section_create' template_id=template.pk %}" role="button" class="outline">
        {% blocktrans with section=term.section|default:"Section" %}Add {{ section }}{% endblocktrans %}
    </a>
</p>

{% for section in template.sections.all %}
<article>
    <header>
        <hgroup>
            <h3>{{ section.name }}</h3>
            {% if section.program %}
            <p><small>{{ term.program|default:"Program" }}: {{ section.program.translated_name }}</small></p>
            {% endif %}
        </hgroup>
        <nav aria-label="{% trans 'Section actions' %}">
            <a href="{% url 'plan_templates:template_section_edit' section_id=section.pk %}">{% trans "Edit" %}</a>
            &middot;
            <a href="{% url 'plan_templates:template_section_delete' section_id=section.pk %}" class="secondary">{% trans "Delete" %}</a>
        </nav>
    </header>

    <h4>{{ term.target_plural|default:"Targets" }}</h4>

    {% if section.targets.all %}
    <table role="grid" aria-label="{{ term.target_plural|default:'Targets' }} in {{ section.name }}">
        <thead>
            <tr>
                <th scope="col">{% trans "Name" %}</th>
                <th scope="col">{% trans "Description" %}</th>
                <th scope="col">{% trans "Order" %}</th>
                <th scope="col">{% trans "Actions" %}</th>
            </tr>
        </thead>
        <tbody>
            {% for target in section.targets.all %}
            <tr>
                <td>{{ target.name }}</td>
                <td>{{ target.description|truncatewords:12 }}</td>
                <td>{{ target.sort_order }}</td>
                <td>
                    <a href="{% url 'plan_templates:template_target_edit' target_id=target.pk %}">{% trans "Edit" %}</a>
                    &middot;
                    <a href="{% url 'plan_templates:template_target_delete' target_id=target.pk %}" class="secondary">{% trans "Delete" %}</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p><em>{% blocktrans with targets=term.target_plural|default:"targets" %}No {{ targets }} yet.{% endblocktrans %}</em></p>
    {% endif %}

    <p>
        <a href="{% url 'plan_templates:template_target_create' section_id=section.pk %}" class="outline">
            {% blocktrans with target=term.target|default:"Target" %}Add {{ target }}{% endblocktrans %}
        </a>
    </p>
</article>
{% empty %}
<p>{% blocktrans with sections=term.section_plural|default:"sections" %}No {{ sections }} yet.{% endblocktrans %} {% trans "Add one above." %}</p>
{% endfor %}
{% endblock %}
