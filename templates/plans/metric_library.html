{% extends "base.html" %}
{% load i18n %}

{% block title %}{{ term.metric|default:"Metric" }} {% trans "Library" %} — {{ site.product_name|default:"KoNote2" }}{% endblock %}

{% block content %}
<hgroup>
    <h1>{{ term.metric|default:"Metric" }} {% trans "Library" %}</h1>
    <p>{% blocktrans with metrics=term.metric_plural|default:"metrics" %}Manage available {{ metrics }} for outcome tracking.{% endblocktrans %}</p>
</hgroup>

<div role="group" style="margin-bottom: 1rem;">
    <a href="{% url 'plans:metric_create' %}" role="button" class="outline">
        {% blocktrans with metric=term.metric|default:"Metric" %}Add Custom {{ metric }}{% endblocktrans %}
    </a>
    <a href="{% url 'plans:metric_import' %}" role="button" class="outline secondary">
        {% trans "Import from CSV" %}
    </a>
    <a href="{% url 'plans:metric_export' %}" role="button" class="outline secondary">
        {% trans "Export to CSV" %}
    </a>
</div>

{% for category, metrics in metrics_by_category.items %}
<section aria-labelledby="cat-{{ forloop.counter }}">
    <h2 id="cat-{{ forloop.counter }}">{{ category }}</h2>
    <table role="grid" aria-label="{{ category }} {{ term.metric_plural|default:'metrics' }}">
        <thead>
            <tr>
                <th scope="col">{% trans "Name" %}</th>
                <th scope="col">{% trans "Unit" %}</th>
                <th scope="col">{% trans "Range" %}</th>
                <th scope="col">{% trans "Library" %}</th>
                <th scope="col">{% trans "Enabled" %}</th>
                <th scope="col">{% trans "Actions" %}</th>
            </tr>
        </thead>
        <tbody>
            {% for metric in metrics %}
            <tr>
                <td>
                    <strong>{{ metric.name }}</strong>
                    <br><small>{{ metric.definition|truncatewords:15 }}</small>
                </td>
                <td>{{ metric.unit|default:"—" }}</td>
                <td>
                    {% if metric.min_value != None or metric.max_value != None %}
                        {{ metric.min_value|default:"—" }} {% trans "to" %} {{ metric.max_value|default:"—" }}
                    {% else %}
                        —
                    {% endif %}
                </td>
                <td>{% if metric.is_library %}{% trans "Yes" %}{% else %}{% trans "Custom" %}{% endif %}</td>
                <td id="metric-toggle-{{ metric.pk }}">
                    {% include "plans/_metric_toggle.html" with metric=metric %}
                </td>
                <td>
                    <a href="{% url 'plans:metric_edit' metric_id=metric.pk %}" aria-label="{% blocktrans with name=metric.name %}Edit {{ name }}{% endblocktrans %}">{% trans "Edit" %}</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>
{% empty %}
<p>{% blocktrans with metrics=term.metric_plural|default:"metrics" %}No {{ metrics }} defined yet.{% endblocktrans %}</p>
{% endfor %}
{% endblock %}
