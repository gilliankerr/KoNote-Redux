{% extends "base.html" %}
{% load i18n %}

{% block title %}{{ term.metric_plural|default:"Metrics" }} — {{ target.name }}{% endblock %}

{% block content %}
<hgroup>
    <h1>{% blocktrans with metrics=term.metric_plural|default:"Metrics" %}Assign {{ metrics }}{% endblocktrans %}</h1>
    <p>{{ term.target|default:"Target" }}: {{ target.name }} — {{ client.display_name }} {{ client.last_name }}</p>
</hgroup>

<form method="post">
    {% csrf_token %}

    {% for category, metrics in metrics_by_category.items %}
    <fieldset>
        <legend>{{ category }}</legend>
        {% for metric in metrics %}
        <label>
            <input type="checkbox" name="metrics" value="{{ metric.pk }}"
                   {% if metric.pk in form.initial.metrics %}checked{% endif %}>
            <strong>{{ metric.name }}</strong>
            {% if metric.unit %}<small>({{ metric.unit }})</small>{% endif %}
            <br><small>{{ metric.definition|truncatewords:20 }}</small>
        </label>
        {% endfor %}
    </fieldset>
    {% empty %}
    {% url 'plans:metric_library' as metric_library_url %}
    <p>{% blocktrans with metrics=term.metric_plural|default:"metrics" %}No enabled {{ metrics }} available.{% endblocktrans %} {% blocktrans with url=metric_library_url %}An administrator can add them in the <a href="{{ url }}">metric library</a>.{% endblocktrans %}</p>
    {% endfor %}

    <div role="group">
        <button type="submit">{% blocktrans with metrics=term.metric_plural|default:"Metrics" %}Save {{ metrics }}{% endblocktrans %}</button>
        <a href="{% url 'plans:plan_view' client_id=client.pk %}" role="button" class="outline secondary">{% trans "Cancel" %}</a>
    </div>
</form>
{% endblock %}
