{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Apply Template" %} â€” {{ site.product_name|default:"KoNote" }}{% endblock %}

{% block content %}
<nav aria-label="{% trans 'Breadcrumb' %}">
    <ul>
        <li><a href="{% url 'plans:plan_view' client_id=client_file.pk %}">{{ term.plan|default:"Plan" }}</a></li>
        <li>{% trans "Apply Template" %}</li>
    </ul>
</nav>

<hgroup>
    <h1>{% blocktrans with plan=term.plan|default:"Plan" %}Apply a {{ plan }} Template{% endblocktrans %}</h1>
    <p>{% blocktrans with sections=term.section_plural|default:"sections" targets=term.target_plural|default:"targets" client=term.client|default:"participant" plan=term.plan|default:"plan" %}Choose a template to add {{ sections }} and {{ targets }} to this {{ client }}'s {{ plan }}.{% endblocktrans %}</p>
</hgroup>

<article aria-label="{% trans 'Important information' %}">
    <p><strong>{% trans "Note:" %}</strong> {% blocktrans with sections=term.section_plural|default:"sections" targets=term.target_plural|default:"targets" plan=term.plan|default:"plan" %}Applying a template will <em>add</em> {{ sections }} and {{ targets }} to the existing {{ plan }}. It will not overwrite or remove anything already there.{% endblocktrans %}</p>
</article>

{% if templates %}
{% for tmpl in templates %}
<article>
    <header>
        <h2>{{ tmpl.name }}</h2>
    </header>
    {% if tmpl.description %}
    <p>{{ tmpl.description }}</p>
    {% endif %}
    <p><small>{{ tmpl.sections.count }} {{ term.section_plural|default:"sections" }}, {{ tmpl.sections.all|length }} {% trans "with" %} {{ term.target_plural|default:"targets" }}</small></p>

    <details>
        <summary>{% trans "Preview contents" %}</summary>
        <ul>
            {% for section in tmpl.sections.all %}
            <li>
                <strong>{{ section.name }}</strong>
                {% if section.targets.all %}
                <ul>
                    {% for target in section.targets.all %}
                    <li>{{ target.name }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    </details>

    <form method="post" action="{% url 'plan_templates:template_apply' client_id=client_file.pk template_id=tmpl.pk %}">
        {% csrf_token %}
        <button type="submit">{% trans "Apply This Template" %}</button>
    </form>
</article>
{% endfor %}
{% else %}
<p>{% trans "No active templates available." %} <a href="{% url 'plan_templates:template_list' %}">{% trans "Create one first." %}</a></p>
{% endif %}

<p><a href="{% url 'plans:plan_view' client_id=client_file.pk %}">&larr; {% blocktrans with plan=term.plan|default:"Plan" %}Back to {{ plan }}{% endblocktrans %}</a></p>
{% endblock %}
