{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "History" %} — {{ target.name }}{% endblock %}

{% block content %}
<hgroup>
    <h1>{% blocktrans with target=term.target|default:"Target" %}{{ target }} History{% endblocktrans %}</h1>
    <p>{{ target.name }} — {{ client.first_name }} {{ client.last_name }}</p>
</hgroup>

<a href="{% url 'plans:plan_view' client_id=client.pk %}" role="button" class="outline secondary" style="margin-bottom: 1rem;">{% blocktrans with plan=term.plan|default:"Plan" %}Back to {{ plan }}{% endblocktrans %}</a>

{% if revisions %}
<table role="grid" aria-label="{% trans 'Revision history' %}">
    <thead>
        <tr>
            <th scope="col">{% trans "Date" %}</th>
            <th scope="col">{% trans "Name" %}</th>
            <th scope="col">{% trans "Client's words" %}</th>
            <th scope="col">{% trans "Status" %}</th>
            <th scope="col">{% trans "Reason" %}</th>
            <th scope="col">{% trans "Changed by" %}</th>
        </tr>
    </thead>
    <tbody>
        {% for rev in revisions %}
        <tr>
            <td>{{ rev.created_at|date:"Y-m-d H:i" }}</td>
            <td>{{ rev.name }}</td>
            <td>{% if rev.client_goal %}"{{ rev.client_goal|truncatewords:15 }}"{% else %}—{% endif %}</td>
            <td>
                {% if rev.status == "default" %}
                    <span class="badge badge-success">{% trans "Active" %}</span>
                {% elif rev.status == "completed" %}
                    <span class="badge badge-info">{% trans "Completed" %}</span>
                {% else %}
                    <span class="badge badge-neutral">{% trans "Deactivated" %}</span>
                {% endif %}
            </td>
            <td>{{ rev.status_reason|default:"—" }}</td>
            <td>{% if rev.changed_by %}{{ rev.changed_by.display_name }}{% else %}—{% endif %}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<p><strong>{% trans "Current values:" %}</strong> {{ target.name }} — {{ target.get_status_display }}</p>
{% else %}
<p>{% blocktrans with target=term.target|default:"target" %}No revision history for this {{ target }}.{% endblocktrans %}</p>
{% endif %}
{% endblock %}
