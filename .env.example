# KoNote Web — Environment Variables
# ====================================
# Copy this file to .env and fill in your values.
# See docs/getting-started.md for detailed setup instructions.

# ==============================================================================
# REQUIRED — KoNote will not start without these
# ==============================================================================

# Django secret key — used for session security and CSRF protection
# Generate with: python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
SECRET_KEY=REPLACE_THIS_run_the_command_above_to_generate

# PII encryption key — encrypts client names, emails, birth dates in the database
# Generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
# WARNING: If you lose this key, all encrypted client data is UNRECOVERABLE
# Back up this key separately from your database backups!
FIELD_ENCRYPTION_KEY=REPLACE_THIS_run_the_command_above_to_generate

# Main database connection — stores clients, programs, notes, settings
# Format: postgresql://username:password@host:port/database
DATABASE_URL=postgresql://konote:REPLACE_THIS_WITH_YOUR_PASSWORD@localhost:5432/konote

# Audit database connection — stores immutable audit logs (separate for security)
# Format: postgresql://username:password@host:port/database
AUDIT_DATABASE_URL=postgresql://audit_writer:REPLACE_THIS_WITH_YOUR_PASSWORD@localhost:5433/konote_audit

# ==============================================================================
# DOCKER COMPOSE — Only needed if using docker-compose.yml
# ==============================================================================

# Main database credentials (used by docker-compose to create the database)
POSTGRES_USER=konote
POSTGRES_PASSWORD=REPLACE_THIS_WITH_A_SECURE_PASSWORD
POSTGRES_DB=konote

# Audit database credentials (used by docker-compose to create the audit database)
AUDIT_POSTGRES_USER=audit_writer
AUDIT_POSTGRES_PASSWORD=REPLACE_THIS_WITH_ANOTHER_PASSWORD
AUDIT_POSTGRES_DB=konote_audit

# ==============================================================================
# AUTHENTICATION
# ==============================================================================

# Auth mode: "local" for username/password, "azure" for Azure AD SSO
# Most organisations start with "local" and add Azure AD later
AUTH_MODE=local

# Azure AD settings — only required if AUTH_MODE=azure
# Get these from your Azure Portal > App Registrations
AZURE_CLIENT_ID=
AZURE_CLIENT_SECRET=
AZURE_TENANT_ID=
AZURE_REDIRECT_URI=https://REPLACE_THIS_WITH_YOUR_DOMAIN.com/auth/callback/

# ==============================================================================
# OPTIONAL SETTINGS
# ==============================================================================

# Allowed hosts — domains that can access the application (comma-separated)
# For local development: localhost,127.0.0.1
# For production: your-domain.com,www.your-domain.com
ALLOWED_HOSTS=localhost,127.0.0.1

# Domain for Caddy TLS certificate (production Docker deployment only)
# Set this to your public domain name
DOMAIN=localhost

# Debug mode — set to False in production (shows detailed errors if True)
# DEBUG=False

# ==============================================================================
# EXPORTS AND NOTIFICATIONS
# ==============================================================================

# Export file storage directory (default: system temp folder + konote_exports)
# Must be outside the web root. On Railway, the default /tmp/konote_exports is fine.
# SECURE_EXPORT_DIR=/path/to/exports

# Export download link expiry in hours (default: 24)
# SECURE_EXPORT_LINK_EXPIRY_HOURS=24

# Delay before large exports (100+ clients or including notes) can be downloaded, in minutes (default: 10)
# Gives admins time to review and revoke if needed
# ELEVATED_EXPORT_DELAY_MINUTES=10

# SMTP email settings — required in production for:
#   - Export notifications (admin alerted when large exports are created)
#   - Erasure workflow (program managers notified when approval needed)
#   - Password reset emails (if using local auth)
# If not configured, exports still work but admin notifications fail silently.
# EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
# EMAIL_HOST=smtp.office365.com
# EMAIL_PORT=587
# EMAIL_HOST_USER=notifications@yourorg.ca
# EMAIL_HOST_PASSWORD=your-smtp-password
# EMAIL_USE_TLS=True
# DEFAULT_FROM_EMAIL=KoNote <notifications@yourorg.ca>

# ==============================================================================
# DEMO / EVALUATION
# ==============================================================================

# Demo mode — shows quick-login buttons on login page and seeds demo data (5 users, 10 clients)
# Values: true, 1, yes (case-insensitive). Default: false
# DEMO_MODE=true

# KoNote mode — controls startup security check behaviour
# 'production' (default): blocks startup if critical security checks fail
# 'demo': warns but allows startup for evaluation
# NOTE: This is different from DEMO_MODE. DEMO_MODE controls demo data seeding.
#       KONOTE_MODE controls whether security check failures block startup.
# KONOTE_MODE=production

# ==============================================================================
# AI FEATURES (OPTIONAL)
# ==============================================================================

# OpenRouter API key — enables AI-powered metric suggestions and outcome improvement
# Features are hidden from the UI when this is empty.
# OPENROUTER_API_KEY=sk-or-...

# ==============================================================================
# NOTES
# ==============================================================================
#
# Security reminders:
# - Never commit this file to version control with real values
# - Use different keys for development, staging, and production
# - Rotate FIELD_ENCRYPTION_KEY every 90 days (see docs/security-operations.md)
# - Back up FIELD_ENCRYPTION_KEY in a secure location separate from database backups
#
# Getting errors?
# - KoNote.E001: FIELD_ENCRYPTION_KEY missing or invalid — generate a new one above
# - KoNote.E002: Security middleware missing — check settings.py MIDDLEWARE
# - Database connection refused: Check PostgreSQL is running and credentials match
#
# Full documentation: docs/getting-started.md
